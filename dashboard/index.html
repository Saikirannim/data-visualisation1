<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Air Pollutants Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; }
    .dashboard { display: flex; min-height: 100vh; }
    .sidebar { width: 240px; background-color: #f44336; color: white; padding: 20px; }
    .sidebar h2 { margin-bottom: 20px; font-size: 22px; }
    .sidebar nav button {
      display: block; width: 100%; background: none; border: none;
      color: white; padding: 10px 0; text-align: left; font-size: 16px; cursor: pointer;
    }
    .sidebar nav button.active {
      background: rgba(0,0,0,0.2); font-weight: bold; border-radius: 5px; padding-left: 10px;
    }
    .main-content { flex: 1; padding: 20px; }
    .top-bar { display: flex; gap: 10px; margin-bottom: 20px; }
    .filter {
      background: white; padding: 10px 20px; border-radius: 10px;
      border: 1px solid #ccc; font-weight: 500;
    }
    .stat-cards { display: flex; gap: 10px; margin-bottom: 20px; }
    .card {
      flex: 1; padding: 15px 20px; border-radius: 12px; font-weight: bold; font-size: 16px;
    }
    .card span { display: block; font-size: 22px; font-weight: bold; margin-top: 5px; }
    .red { background: #ffe5e5; color: #b71c1c; }
    .blue { background: #e3f2fd; color: #0d47a1; }
    .yellow { background: #fffde7; color: #f57f17; }
    .pink { background: #fce4ec; color: #ad1457; }
    .chart-section {
      background: white; padding: 20px; border-radius: 10px;
    }
    #chart svg { width: 100%; height: 400px; }
    .action-buttons { margin-top: 20px; text-align: right; }
    .action-buttons button {
      padding: 10px 25px; margin-left: 10px; border: none;
      background-color: #ff6b6b; color: white; border-radius: 5px;
      font-weight: bold; font-size: 14px; cursor: pointer;
    }
    table {
      width: 100%; border-collapse: collapse; margin-top: 10px;
    }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 10px; text-align: left; }
    th { background-color: #f0f0f0; }
  </style>
</head>
<body>
  <div class="dashboard">
    <aside class="sidebar">
      <h2>Main code</h2>
      <nav>
        <button onclick="loadChart('area')">Area Chart</button>
        <button onclick="loadChart('bar')">Bar Chart</button>
        <button onclick="loadChart('line')">Line Chart</button>
        <button onclick="loadChart('dot')">Dot Chart</button>
        <button onclick="loadChart('donut')">Donut Chart</button>
        <button onclick="loadChart('table')">Data</button>
      </nav>
    </aside>
    <main class="main-content">
      <div class="top-bar">
        <div class="filter">Years: 2012-2019</div>
        <div class="filter">Pollutants</div>
        <div class="filter">Emission Type / Source</div>
        <div class="filter">Regions / Areas</div>
        <div class="filter">Measurement Units</div>
      </div>
      <div class="stat-cards">
        <div class="card red">Total Emission<span>$0</span></div>
        <div class="card blue">Avg Emission / Yr<span>$0</span></div>
        <div class="card yellow">Year with Highest<span>Year</span></div>
        <div class="card pink">Dominant Pollutant<span>Name</span></div>
      </div>
      <div class="chart-section">
        <div id="chart"></div>
      </div>
      <div class="action-buttons">
        <button>Preview</button>
        <button>Share</button>
      </div>
    </main>
  </div>

  <script>
    let chartData = [];

    d3.csv("air-pollutant-emissions-2012-2019.csv").then(data => {
       chartData = data; // <- raw data, good for table
       loadChart("area"); // load default chart once data is ready
    });


    function loadChart(type) {
        document.querySelectorAll(".sidebar nav button").forEach(btn => btn.classList.remove("active"));
        event.target.classList.add("active");
        d3.select("#chart").html("");
      
        const chartMap = {
          area: 'charts/areaChart.js',
          bar: 'charts/barChart.js',
          line: 'charts/lineChart.js',
          dot: 'charts/dotChart.js',
          donut: 'charts/donutChart.js',
          table: 'charts/tableView.js'
        };
      
        const script = document.createElement("script");
        script.src = chartMap[type];
        document.body.appendChild(script);
      }
      

      const margin = { top: 20, right: 30, bottom: 30, left: 40 },
            width = 800 - margin.left - margin.right,
            height = 400 - margin.top - margin.bottom;

      const svg = d3.select("#chart")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

      const x = d3.scaleTime()
        .domain(d3.extent(chartData, d => d.date))
        .range([0, width]);

      const y = d3.scaleLinear()
        .domain([0.5, d3.max(chartData, d => d.value)])
        .range([height, 0]);

      svg.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x));
      svg.append("g").call(d3.axisLeft(y));

      if (type === "area") {
        const area = d3.area()
          .x(d => x(d.date))
          .y0(height)
          .y1(d => y(d.value));
        svg.append("path")
          .datum(chartData)
          .attr("fill", "lightgreen")
          .attr("stroke", "green")
          .attr("stroke-width", 2)
          .attr("d", area);
      } else if (type === "bar") {
        svg.selectAll("rect")
          .data(chartData)
          .enter()
          .append("rect")
          .attr("x", d => x(d.date))
          .attr("y", d => y(d.value))
          .attr("width", 30)
          .attr("height", d => height - y(d.value))
          .attr("fill", "steelblue");
      } else if (type === "line") {
        const line = d3.line()
          .x(d => x(d.date))
          .y(d => y(d.value));
        svg.append("path")
          .datum(chartData)
          .attr("fill", "none")
          .attr("stroke", "orange")
          .attr("stroke-width", 2)
          .attr("d", line);
      } else if (type === "dot") {
        svg.selectAll("circle")
          .data(chartData)
          .enter()
          .append("circle")
          .attr("cx", d => x(d.date))
          .attr("cy", d => y(d.value))
          .attr("r", 5)
          .attr("fill", "purple");
      } else if (type === "donut") {
        const radius = Math.min(width, height) / 2;
        const pieSvg = d3.select("#chart").select("svg")
          .append("g")
          .attr("transform", `translate(${width / 2}, ${height / 2})`);
        const pie = d3.pie().value(d => d.value);
        const arc = d3.arc().innerRadius(radius / 2).outerRadius(radius);
        const arcs = pieSvg.selectAll("arc")
          .data(pie(chartData))
          .enter()
          .append("g");
        arcs.append("path")
          .attr("d", arc)
          .attr("fill", (d, i) => d3.schemeCategory10[i]);
      }
    
  </script>
</body>
</html>
